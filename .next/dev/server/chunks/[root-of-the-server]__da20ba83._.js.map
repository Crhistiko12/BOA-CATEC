{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DESTOCK/Desktop/semana%20C%20-%20proyecto%20MVC%20BOA/BOA-CATEC/services/chatbotService.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = new PrismaClient()\r\n\r\n// URL del servidor Rasa (por defecto localhost:5005)\r\nconst RASA_API_URL = process.env.RASA_API_URL || 'http://localhost:5005/webhooks/rest/webhook'\r\n\r\n// Respuestas simuladas para cuando Rasa no estÃ© disponible\r\nconst FALLBACK_RESPONSES: Record<string, string[]> = {\r\n    greet: [\r\n        \"Â¡Hola! Soy el asistente virtual de BOA. Â¿En quÃ© puedo ayudarte hoy?\",\r\n        \"Â¡Bienvenido a BOA! Â¿CÃ³mo puedo asistirte?\"\r\n    ],\r\n    goodbye: [\r\n        \"Â¡Hasta pronto! Que tengas un excelente vuelo con BOA.\",\r\n        \"Gracias por contactar a BOA. Â¡Buen viaje!\"\r\n    ],\r\n    flight_status: [\r\n        \"Para consultar el estado de tu vuelo, por favor proporciona tu nÃºmero de vuelo (ej: OB-760).\"\r\n    ],\r\n    baggage: [\r\n        \"En BOA, cada pasajero puede llevar:\\n- 1 maleta de mano (10kg)\\n- 1 equipaje facturado (23kg en econÃ³mica, 32kg en ejecutiva)\\n\\nÂ¿Necesitas registrar equipaje especial?\"\r\n    ],\r\n    refund: [\r\n        \"Para solicitar un reembolso:\\n1. Ingresa a tu cuenta en boa.bo\\n2. Ve a 'Mis Reservas'\\n3. Selecciona 'Solicitar Reembolso'\\n\\nLos reembolsos se procesan en 7-15 dÃ­as hÃ¡biles.\"\r\n    ],\r\n    ticket: [\r\n        \"AquÃ­ tienes una copia digital de tu boleto para el vuelo OB-760.\\n\\n[ðŸ“„ Descargar Boleto PDF](#)\",\r\n        \"He enviado una copia de tu itinerario a tu correo electrÃ³nico registrado.\"\r\n    ],\r\n    gate: [\r\n        \"Tu vuelo OB-760 a Miami sale por la **Puerta 4**.\\nEl embarque comienza a las 21:15.\",\r\n        \"Estado actual: **A TIEMPO**. Puerta: 4.\"\r\n    ],\r\n    invoice: [\r\n        \"Puedes generar tu factura ingresando tu apellido y cÃ³digo de reserva en: boa.bo/facturacion\",\r\n        \"Â¿Necesitas factura para el vuelo OB-760? He generado el borrador. Confirma tus datos fiscales.\"\r\n    ],\r\n    change: [\r\n        \"Para cambios de fecha o ruta:\\n1. Ve a 'Mis Viajes'\\n2. Selecciona 'Cambiar Vuelo'\\n3. Elige la nueva fecha\\n\\nNota: Puede aplicar diferencia tarifaria.\",\r\n        \"Â¿Quieres adelantar tu vuelo? Hay espacio disponible en el vuelo de las 18:00. Â¿Te interesa?\"\r\n    ],\r\n    checkin: [\r\n        \"Â¡Hagamos tu check-in ahora! He encontrado tu reserva OB-123456.\\n\\nAsiento asignado: 12F.\\n[âœ… Confirmar Check-in](#)\",\r\n    ],\r\n    default: [\r\n        \"Lo siento, no entendÃ­ eso. Â¿PodrÃ­as reformularlo?\",\r\n        \"Disculpa, no comprendÃ­. Puedo ayudarte con: vuelos, equipaje, reembolsos, check-in, mascotas, facturas, puerta de embarque o cambios de fecha.\"\r\n    ]\r\n}\r\n\r\nfunction getSimulatedResponse(message: string): string {\r\n    const lowerMessage = message.toLowerCase()\r\n\r\n    if (lowerMessage.includes('hola') || lowerMessage.includes('buenos')) {\r\n        return FALLBACK_RESPONSES.greet[0]\r\n    }\r\n    if (lowerMessage.includes('adios') || lowerMessage.includes('chao')) {\r\n        return FALLBACK_RESPONSES.goodbye[0]\r\n    }\r\n    if (lowerMessage.includes('vuelo') || lowerMessage.includes('flight') || lowerMessage.includes('estado')) {\r\n        return FALLBACK_RESPONSES.flight_status[0]\r\n    }\r\n    if (lowerMessage.includes('equipaje') || lowerMessage.includes('maleta')) {\r\n        return FALLBACK_RESPONSES.baggage[0]\r\n    }\r\n    if (lowerMessage.includes('reembolso') || lowerMessage.includes('devol')) {\r\n        return FALLBACK_RESPONSES.refund[0]\r\n    }\r\n    if (lowerMessage.includes('ticket') || lowerMessage.includes('boleto') || lowerMessage.includes('pasaje')) {\r\n        return FALLBACK_RESPONSES.ticket[0]\r\n    }\r\n    if (lowerMessage.includes('puerta') || lowerMessage.includes('gate') || lowerMessage.includes('embarque')) {\r\n        return FALLBACK_RESPONSES.gate[0]\r\n    }\r\n    if (lowerMessage.includes('factura') || lowerMessage.includes('nit')) {\r\n        return FALLBACK_RESPONSES.invoice[0]\r\n    }\r\n    if (lowerMessage.includes('cambio') || lowerMessage.includes('fecha') || lowerMessage.includes('reprogramar')) {\r\n        return FALLBACK_RESPONSES.change[0]\r\n    }\r\n    if (lowerMessage.includes('check') || lowerMessage.includes('abordar')) {\r\n        return FALLBACK_RESPONSES.checkin[0]\r\n    }\r\n\r\n    return FALLBACK_RESPONSES.default[0]\r\n}\r\n\r\nexport const chatbotService = {\r\n    async processMessage(sessionId: string, message: string) {\r\n        try {\r\n            let botMessages: string[] = []\r\n\r\n            // Intentar conectar con Rasa\r\n            try {\r\n                const response = await fetch(RASA_API_URL, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                    },\r\n                    body: JSON.stringify({\r\n                        sender: sessionId,\r\n                        message: message,\r\n                    }),\r\n                })\r\n\r\n                if (response.ok) {\r\n                    const rasaResponses = await response.json()\r\n\r\n                    if (rasaResponses.length === 0) {\r\n                        botMessages.push(getSimulatedResponse(message))\r\n                    } else {\r\n                        for (const r of rasaResponses) {\r\n                            if (r.text) {\r\n                                botMessages.push(r.text)\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    console.log('Rasa server not available, using fallback responses')\r\n                    botMessages.push(getSimulatedResponse(message))\r\n                }\r\n            } catch (fetchError) {\r\n                console.log('Rasa connection error, using fallback responses:', fetchError)\r\n                botMessages.push(getSimulatedResponse(message))\r\n            }\r\n\r\n            return botMessages\r\n\r\n        } catch (error) {\r\n            console.error('Chatbot Error:', error)\r\n            return ['Lo siento, tengo problemas para procesar tu mensaje en este momento.']\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/DESTOCK/Desktop/semana%20C%20-%20proyecto%20MVC%20BOA/BOA-CATEC/app/api/chat/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport { chatbotService } from '@/services/chatbotService'\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const { message, sessionId } = await request.json()\r\n\r\n        if (!message) {\r\n            return NextResponse.json({ error: 'Mensaje requerido' }, { status: 400 })\r\n        }\r\n\r\n        // Generar un ID de sesiÃ³n si no existe\r\n        const currentSessionId = sessionId || crypto.randomUUID()\r\n\r\n        // El servicio devuelve un array de strings (mensajes del bot)\r\n        const botMessages = await chatbotService.processMessage(currentSessionId, message)\r\n\r\n        return NextResponse.json({\r\n            responses: botMessages,\r\n            sessionId: currentSessionId\r\n        })\r\n    } catch (error) {\r\n        console.error('Chat API Error:', error)\r\n        return NextResponse.json(\r\n            { error: 'Error interno del chat' },\r\n            { status: 500 }\r\n        )\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,uCAAuC;QACvC,MAAM,mBAAmB,aAAa,OAAO,UAAU;QAEvD,8DAA8D;QAC9D,MAAM,cAAc,MAAM,8IAAc,CAAC,cAAc,CAAC,kBAAkB;QAE1E,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,WAAW;YACX,WAAW;QACf;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}